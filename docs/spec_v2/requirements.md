# 需求文档 - 第二版

## 介绍

班级积分管理系统第二版是一个支持多班级的简洁积分管理工具。系统通过三个入口地址提供服务：教室大屏（师生共用）、班级后台（教师专用）、系统管理（管理员专用，暂不提供界面）。每个班级数据完全隔离，支持数据库存储提升可靠性。

## 需求

### 需求 1 - 多班级数据隔离

**用户故事：** 作为系统，我希望支持多个班级同时使用，每个班级通过唯一classKey访问，数据完全隔离。

#### 验收标准

1. 当系统管理员创建班级时，应当为班级设置唯一的classKey，未设置时默认使用classId
2. 当用户访问教室大屏时，应当通过URL访问 /class/[classkey]/display
3. 当用户访问班级后台时，应当通过URL访问 /class/[classkey]/admin
4. 当班级用户操作时，数据应当完全隔离，不影响其他班级
5. 如果访问不存在的classKey，系统应当显示友好错误提示

### 需求 2 - 教室大屏入口

**用户故事：** 作为教室大屏，我希望为师生提供统一的操作界面，支持平时模式和上课模式的切换，并能自动管理登录状态。

#### 验收标准

1. 当教室大屏首次访问时，应当要求班主任账号登录确认并长期保持登录状态
2. 当因浏览器重装等原因退出时，应当要求班主任重新登录确认
3. 当大屏处于平时模式时，应当在界面底部提供学生查询入口，允许学生通过学号查询积分和预约商品
4. 当切换到上课模式时，应当显示任课老师选择列表，无需任课老师登录账号
5. 当选择任课老师后，应当根据班级配置要求输入班级切换密码（如果启用）
6. 当班主任在后台配置时，应当能够设置是否需要切换密码以及具体密码内容
7. 当上课模式激活时，学生查询功能应当被禁用，显示积分操作界面
8. 当上课模式持续2小时后，系统应当自动切换回平时模式

### 需求 3 - 班级后台入口

**用户故事：** 作为班级教师，我希望通过专门的后台地址管理班级事务，班主任拥有完整权限，任课老师只能操作积分。

#### 验收标准

1. 当班主任登录后台时，应当能够访问学生管理、教师管理、商品管理、预约管理等功能
2. 当班主任管理常用奖惩项时，应当能够设置名称、分数和类型供大屏使用
3. 当班主任执行积分清零时，应当要求二次确认操作
4. 当任课老师登录后台时，应当只能访问积分管理功能
5. 如果教师权限不足，系统应当显示权限不足提示

### 需求 4 - 常用奖惩项管理

**用户故事：** 作为班主任，我希望设置常用的奖惩项目，让任课老师在大屏上课模式时能够快速操作。

#### 验收标准

1. 当班主任设置奖惩项时，应当能够定义名称、分数和类型（奖励/惩罚）
2. 当大屏处于上课模式时，应当显示所有可用的奖惩项按钮
3. 当任课老师选择学生和奖惩项时，应当能够一键完成积分操作
4. 当使用奖惩项时，系统应当自动记录操作原因和分数变化
5. 当奖惩项被修改时，大屏界面应当实时更新

### 需求 5 - 数据库持久化

**用户故事：** 作为系统，我希望支持MySQL和SQLite两种数据库存储，满足不同部署场景的需求。

#### 验收标准

1. 当系统配置为多班级模式时，应当使用MySQL8数据库存储
2. 当系统配置为单班级本地部署时，应当使用SQLite数据库存储
3. 当使用任何数据库时，所有操作应当支持事务确保数据一致性
4. 当数据库连接失败时，系统应当显示明确的错误提示
5. 如果使用数据库，系统应当支持基本的数据备份功能

### 需求 6 - 学生访问控制

**用户故事：** 作为系统，我希望学生只能通过教室大屏访问系统，确保使用场景的可控性。

#### 验收标准

1. 当学生尝试直接访问班级后台URL时，系统应当拒绝访问
2. 当教室大屏处于平时模式时，应当允许学生查询积分和预约商品
3. 当教室大屏处于上课模式时，学生功能应当被禁用
4. 当检测到非大屏访问时，系统应当记录访问日志
5. 如果需要，系统应当支持IP白名单限制访问来源

### 需求 8 - 积分展示系统

**用户故事：** 作为学生，我希望能在教室大屏上直观地看到所有同学的积分情况，这样我可以了解自己的排名和积分状态。

#### 验收标准

1. 当系统处于平时模式时，大屏应当显示所有学生的当前积分余额
2. 当系统处于平时模式时，大屏应当显示日榜排行（当日积分变化）
3. 当系统处于平时模式时，大屏应当显示周榜排行（本周积分变化）
4. 当积分数据更新时，大屏显示应当自动刷新

### 需求 9 - 教师积分管理

**用户故事：** 作为教师，我希望能够方便地为学生加分或减分，学生按学号排序便于查找。

#### 验收标准

1. 当系统处于上课模式时，学生列表应当按学号升序排列显示
2. 当教师进行积分操作时，应当能够选择学生并进行加分或减分操作
3. 当教师进行积分操作时，系统应当立即更新学生的积分余额
4. 当教师进行积分操作时，系统应当记录操作时间、操作类型和分数变化
5. 如果学生积分余额不足，系统应当允许减分操作（可为负数）
6. 当新学生添加时，上课模式应当自动按学号重新排序显示

### 需求 10 - 学生积分账户

**用户故事：** 作为学生，我希望能够使用学号登录查看我的积分余额和操作记录，这样我可以了解自己的积分变化情况。

#### 验收标准

1. 当学生输入学号时，系统应当允许登录（无需密码）
2. 当学生登录后，系统应当显示个人当前积分余额
3. 当学生登录后，系统应当显示个人本周操作记录
4. 当学生登录后，系统应当显示个人在班级中的排名

### 需求 11 - 积分累积规则

**用户故事：** 作为班主任，我希望积分能够按学期累积，并且有清零功能备用，这样可以灵活管理积分周期。

#### 验收标准

1. 当新学期开始时，学生积分应当保持累积（不自动清零）
2. 当班主任手动触发清零时，系统应当要求二次确认操作
3. 当积分清零时，系统应当将所有学生积分重置为0但保留历史记录
4. 当任课老师尝试清零时，系统应当提示权限不足
5. 如果清零操作失败，系统应当回滚所有变更

### 需求 12 - 商品管理系统

**用户故事：** 作为班主任，我希望能够管理商城中的奖品商品，包括添加商品、设置积分价格和管理库存。

#### 验收标准

1. 当班主任登录管理端时，应当能够添加新的奖品商品
2. 当班主任管理商品时，应当能够设置商品名称、积分价格和库存数量
3. 当班主任管理商品时，应当能够修改现有商品的信息
4. 当商品库存为0时，系统应当在前端显示"缺货"状态

### 需求 13 - 商品预约系统

**用户故事：** 作为学生，我希望能够预约想要兑换的商品，然后与老师约定时间完成兑换，这样避免了复杂的即时购买流程。

#### 验收标准

1. 当学生查看商品列表时，应当能够看到所有可用商品及其积分价格
2. 当学生积分足够时，应当能够预约商品兑换
3. 当学生预约商品时，系统应当冻结相应积分但不立即扣除
4. 当教师确认兑换完成时，系统应当扣除学生积分并减少商品库存
5. 当学生取消预约时，系统应当解冻相应积分

### 需求 14 - 系统模式切换

**用户故事：** 作为教师，我希望能够在上课模式和平时模式之间切换，这样可以根据不同场景使用不同功能。

#### 验收标准

1. 当教师切换到上课模式时，大屏应当显示积分操作界面
2. 当教师切换到平时模式时，大屏应当显示积分排行榜
3. 当系统处于上课模式时，学生不应当能够进行预约操作
4. 当系统模式切换时，界面应当立即更新显示内容

### 需求 15 - 数据持久化可靠性

**用户故事：** 作为系统管理员，我希望所有积分数据和操作记录能够可靠保存，确保数据不会丢失。

#### 验收标准

1. 当系统重启时，所有学生积分数据应当保持不变
2. 当系统重启时，所有商品信息应当保持不变
3. 当系统重启时，所有操作记录应当保持不变
4. 当数据发生变化时，系统应当立即保存到数据库存储
5. 当数据库操作失败时，系统应当提供事务回滚机制

